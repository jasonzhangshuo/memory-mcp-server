# Phase 0 测试验证计划

## 测试目标

验证 Skill 触发机制和 MCP 工具调用的可行性，目标通过率 ≥87.5%（8个测试用例中至少7个通过）

## 测试环境准备

1. **确保 MCP Server 已启动**
   ```bash
   cd memory-mcp-server
   source venv/bin/activate
   python main.py
   ```

2. **确保 Cursor/Claude 已配置 MCP Server**
   - 在 Cursor 设置中添加 MCP Server 配置
   - Server 名称：`personal_memory`
   - 命令：`python /path/to/memory-mcp-server/main.py`
   - 传输方式：stdio

3. **确保种子数据已加载**
   ```bash
   python storage/seed.py
   ```

## 测试用例

### 必须通过的用例（5个）- 目标：100%通过

#### T1: 显式读取 - 历史引用
**用户输入**：`"我们上次聊的戒糖，后来怎样了"`

**期望行为**：
- ✅ AI 识别到"上次聊的"触发词
- ✅ AI 调用 `memory_search` 工具，query="戒糖"
- ✅ AI 基于搜索结果回答（如果找到）或告知未找到

**验收标准**：必须调用 memory_search 工具

---

#### T2: 显式读取 - 目标查询
**用户输入**：`"我的目标是什么"`

**期望行为**：
- ✅ AI 识别到"我的目标"触发词
- ✅ AI 调用 `memory_search` 工具，query="目标" 或 category="goal"
- ✅ AI 返回找到的目标信息（应该能找到"核心目标：50岁退休"）

**验收标准**：必须调用 memory_search 工具，并返回目标信息

---

#### T3: 显式保存 - 保存请求
**用户输入**：`"记住：我周二有禅修课"`

**期望行为**：
- ✅ AI 识别到"记住"触发词
- ✅ AI 调用 `memory_add` 工具
- ✅ AI 确认"已记录"

**验收标准**：必须调用 memory_add 工具

---

#### T4: 项目上下文 - 新对话
**用户输入**：（新对话开始，在项目上下文中）

**期望行为**：
- ✅ AI 识别到项目上下文
- ✅ AI 调用 `memory_get_project_context` 工具（如果已实现）
- ✅ 或调用 `memory_search` 加载项目相关记忆

**验收标准**：必须尝试加载项目上下文

---

#### T5: 空结果处理 - 未找到记录
**用户输入**：`"我们讨论过量子计算吗"`

**期望行为**：
- ✅ AI 调用 `memory_search` 工具，query="量子计算"
- ✅ 返回空结果
- ✅ AI 诚实告知"没有找到相关记录"，不编造内容

**验收标准**：必须调用工具，返回空结果时不编造

---

### 期望通过的用例（3个）- 目标：≥66%通过

#### T6: 隐式读取 - 进展查询
**用户输入**：`"我的戒糖进展如何"`

**期望行为**：
- ✅ AI 识别到"进展"触发词
- ✅ AI 调用 `memory_search` 工具

**验收标准**：期望调用 memory_search 工具

---

#### T7: 隐式保存 - 重要决定
**用户输入**：`"我决定每天冥想10分钟"`

**期望行为**：
- ✅ AI 识别到"我决定"触发词
- ✅ AI 询问是否保存（重要决定需确认）
- ✅ 用户确认后调用 `memory_add` 工具

**验收标准**：期望询问确认并保存

---

#### T8: 无关问题 - 不触发
**用户输入**：`"Python的for循环怎么写"`

**期望行为**：
- ✅ AI 不调用任何记忆相关工具
- ✅ AI 直接回答 Python 问题

**验收标准**：不误触发记忆工具

---

## 测试执行记录

| 用例ID | 类型 | 用户输入 | 是否调用工具 | 工具名称 | 结果 | 备注 |
|--------|------|---------|------------|---------|------|------|
| T1 | 必须 | "我们上次聊的戒糖，后来怎样了" | ⬜ | - | ⬜ | |
| T2 | 必须 | "我的目标是什么" | ⬜ | - | ⬜ | |
| T3 | 必须 | "记住：我周二有禅修课" | ⬜ | - | ⬜ | |
| T4 | 必须 | （新对话+项目上下文） | ⬜ | - | ⬜ | |
| T5 | 必须 | "我们讨论过量子计算吗" | ⬜ | - | ⬜ | |
| T6 | 期望 | "我的戒糖进展如何" | ⬜ | - | ⬜ | |
| T7 | 期望 | "我决定每天冥想10分钟" | ⬜ | - | ⬜ | |
| T8 | 期望 | "Python的for循环怎么写" | ⬜ | - | ⬜ | |

## 验收标准

- **必须通过的用例**：100%通过（5/5）
- **期望通过的用例**：≥66%通过（2/3）
- **总体通过率**：≥87.5%（7/8）

## 测试方法

1. 在 Cursor/Claude 中逐个输入测试用例
2. 观察 AI 是否调用了相应的工具
3. 检查工具调用参数是否正确
4. 验证 AI 的回答是否基于工具返回的结果
5. 记录测试结果

## 失败应对策略

如果 Phase 0 失败：

1. **检查 Description 触发关键词**
   - 优化 description，增加关键词覆盖
   - 参考 `references/trigger-patterns.md`

2. **检查 SKILL.md body 规则**
   - 简化规则，减少歧义
   - 明确禁止行为

3. **考虑降级方案**
   - 如果隐式触发 <70%，降级为显式命令模式
   - 使用"查记忆：XX"、"记下来：XX"等显式命令
